!function(e,t){"function"==typeof define?define(["module"],t):"object"==typeof exports?module.exports=t():e.BasthonBase=t()}(this,function(e){"use strict";function t(e){this.message=`Function ${e} not implemented!`}return class{constructor(){this.loaded=!1,this.urlScript=function(){if(null!=e){let t=window.location.origin+window.location.pathname;return(t=t.substring(0,t.lastIndexOf("/"))+"/")+e.uri}return document.currentScript.src}(),this.pageLoad=this._pageLoad(),this.load=this.launch().then(()=>{this.loaded=!0,this.addEventListener("eval.request",this.evalFromEvent.bind(this))})}version(){throw new t("version")}async launch(){throw new t("launch")}evalAsync(e,n,o,r=null){throw new t("evalAsync")}restart(){throw new t("restart")}putFile(e,n){throw new t("putFile")}putModule(e,n){throw new t("putModule")}putRessource(e,n){throw new t("putRessource")}userModules(){throw new t("userModules")}getFile(e){throw new t("getFile")}getUserModuleFile(e){throw new t("getUserModuleFile")}more(e){throw new t("more")}banner(){throw new t("banner")}complete(e){return[]}dirname(e){return e.substring(0,e.lastIndexOf("/"))}basthonRoot(){return this.dirname(this.urlScript)+"/"+this.version()}download(e,t){let n=new Blob([e],{type:"application/octet-stream"}),o=document.createElement("a");o.download=t,o.href=window.URL.createObjectURL(n),o.target="_blank",o.style.display="none",document.body.appendChild(o),o.click(),document.body.removeChild(o)}loadScript(e){return new Promise(function(t,n){let o=document.createElement("script");o.onload=t,o.onerror=n,o.src=e,document.head.appendChild(o)})}_pageLoad(){return new Promise(function(e,t){"complete"===document.readyState?e():window.addEventListener("load",function(){window.removeEventListener("load",this),e()})})}xhr(e){const t=new XMLHttpRequest;t.open(e.method,e.url,!0),null!=e.responseType&&(t.responseType=e.responseType);const n=new Promise(function(e,n){t.onload=function(){t.status>=200&&t.status<300?e(t.response):n(t)},t.onerror=function(){n(t)}});e.headers&&Object.keys(e.headers).forEach(function(n){t.setRequestHeader(n,e.headers[n])});let o=e.data;return o&&"object"==typeof o&&(o=JSON.stringify(o)),t.send(o),n}dispatchEvent(e,t){const n=new CustomEvent("basthon."+e,{detail:t});document.dispatchEvent(n)}addEventListener(e,t){document.addEventListener("basthon."+e,function(e){t(e.detail)})}clone(e){return JSON.parse(JSON.stringify(e))}evalFromEvent(e){if(!this.loaded)return;const t=this;let n=function(n){return function(o){let r=t.clone(e);r.stream=n,r.content=o,t.dispatchEvent("eval.output",r)}},o=n("stdout"),r=n("stderr");return t.evalAsync(e.code,o,r,e).then(function(n){const o=n[0],r=n[1];let s=t.clone(e);s.execution_count=r,void 0!==o&&(s.result=o),t.dispatchEvent("eval.finished",s)},function(n){r(n.toString());let o=t.clone(e);o.error=n,o.execution_count=t.execution_count,t.dispatchEvent("eval.error",o)})}}});
//# sourceMappingURL=basthon_base.min.js.map